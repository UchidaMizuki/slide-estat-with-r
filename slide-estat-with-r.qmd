---
title: "e-StatğŸ¤R"
format: 
  revealjs
---

## [e-Stat](https://www.e-stat.go.jp)ã¨ã¯â“

-   æ—¥æœ¬ã®æ”¿åºœçµ±è¨ˆãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ
-   å¤šãã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒæ¤œç´¢ãƒ»é–²è¦§ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_001_1.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œç´¢ğŸ”

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_003.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠğŸ‘†

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_039.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 3. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’é¸æŠâœ…

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_040.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ğŸ’¾

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/dbview01_1.png){fig-align="center"}

## e-StatğŸ¤R {auto-animate="true"}

### [e-Stat API](https://www.e-stat.go.jp/api/)

Rã‹ã‚‰ã‚‚e-Statã‚’åˆ©ç”¨å¯èƒ½â©[estatapi](https://yutannihilation.github.io/estatapi/)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ğŸ“¦

1.  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œç´¢ğŸ”
2.  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠğŸ‘†
3.  ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’é¸æŠâœ…
4.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ğŸ’¾

## e-StatğŸ¤R {auto-animate="true"}

### [e-Stat API](https://www.e-stat.go.jp/api/)

Step 3ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ»æ•´å½¢ãŒã‚„ã‚„é›£ã—ã„ğŸ˜–

3.  ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’é¸æŠâœ…
4.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ğŸ’¾

::: {.fragment .fade-in}
### [jpstat](https://uchidamizuki.github.io/jpstat/)ğŸ“¦

-   dplyrğŸ“¦ã¨ãƒ‘ã‚¤ãƒ—ï¼ˆ`|>, %>%`ï¼‰ã§ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºå¯èƒ½ğŸ‘
-   çµ±è¨ˆãƒ‡ãƒ¼ã‚¿åé›†ã®åŠ¹ç‡æ€§ãƒ»å†ç¾æ€§å‘ä¸ŠğŸ‘
:::

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’è¨­å®š[^1]

[^1]: äº‹å‰ã«[åˆ©ç”¨è¦ç´„](https://www.e-stat.go.jp/api/api-info/api-guide)ã‚’ã”ç¢ºèªãã ã•ã„

-   e-Stat APIã®åˆ©ç”¨ã«ã¯[ãƒ¦ãƒ¼ã‚¶ç™»éŒ²](https://www.e-stat.go.jp/mypage/user/preregister)ãŒå¿…è¦
-   [åˆ©ç”¨ã‚¬ã‚¤ãƒ‰](https://www.e-stat.go.jp/api/api-info/api-guide)ã«å¾“ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’å–å¾—

```{r}
library(tidyverse)
library(jpstat)
```

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "8-9"

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¿…è¦ãªã‚‰ï¼‰ãƒ»èª­ã¿è¾¼ã¿
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("jpstat")) install.packages("jpstat")

library(tidyverse)
library(jpstat)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’è¿½åŠ 
Sys.setenv(ESTAT_API_KEY = "ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID")
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 2. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’å–å¾—[^2]

[^2]: ãƒ¡ã‚¿æƒ…å ±ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™

[å®¶è¨ˆèª¿æŸ»](https://www.e-stat.go.jp/dbview?sid=0003343671)ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å¯¾è±¡[^3]

[^3]: [estatapi](https://yutannihilation.github.io/estatapi/)ğŸ“¦ã®READMEã¨åŒæ§˜ï¼ãŸã ã—ï¼Œã“ã“ã§ã¯2023å¹´ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼

```{r}
#| echo: true

estat(statsDataId = "0003343671") # statsDataId: URLç­‰ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹çµ±è¨ˆè¡¨ID
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 3. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’æŠ½å‡º

`activate(), filter()`ã§ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆé–¢é€£å“ç›®ã‚’æŠ½å‡º

```{r}
#| echo: true
#| code-line-numbers: "2-3"

estat(statsDataId = "0003343671") |> 
  activate(cat01) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ"))
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 3. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’æŠ½å‡º

è¤‡æ•°ã®æŠ½å‡ºå‡¦ç†ã‚’ãƒ‘ã‚¤ãƒ—ï¼ˆ`|>, %>%`ï¼‰ã§ã¤ãªã’ã‚‰ã‚Œã‚‹

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "5-9"

estat(statsDataId = "0003343671") |> 
  activate(cat01) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ")) |> 
  
  activate(area) |> 
  filter(name == "å…¨å›½") |> 
  
  activate(time) |> 
  filter(str_detect(name, "2023å¹´[1-3]æœˆ"))
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

`collect()`ã§ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

```{r}
#| echo: true
#| code-line-numbers: "1,11"

chocolate <- estat(statsDataId = "0003343671") |> 
  activate(cat01) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ")) |> 
  
  activate(area) |> 
  filter(name == "å…¨å›½") |> 
  
  activate(time) |> 
  filter(str_detect(name, "2023å¹´[1-3]æœˆ")) |> 
  
  collect(n = "é‡‘é¡") # `n`ã§åé›†ãƒ‡ãƒ¼ã‚¿ã®åˆ—åã‚’æŒ‡å®š
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

ã“ã®ã¾ã¾ã§ã¯åˆ—åãŒã‚ã‹ã‚Šã¥ã‚‰ãä¸è¦ãªåˆ—ãŒå¤šã„ğŸ˜–

```{r}
#| echo: true

head(chocolate)
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 5. ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢

`rekey(), select()`ã§åé›†ãƒ‡ãƒ¼ã‚¿ã®åˆ—åã‚’æŒ‡å®šã§ãã‚‹

```{r}
#| echo: true
#| code-line-numbers: "2,4,7,9,12"

chocolate <- estat(statsDataId = "0003343671") |> 
  activate(tab) |> select() |> # ä½•ã‚‚`select()`ã—ãªã„å ´åˆã¯åˆ—åãŒæ¶ˆãˆã‚‹
    
  activate(cat01) |> rekey("å“ç›®åˆ†é¡") |> select(name) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ")) |> 
  
  activate(cat02) |> rekey("ä¸–å¸¯åŒºåˆ†") |> select(name) |>
  
  activate(area) |> rekey("åœ°åŸŸåŒºåˆ†") |> select(name) |>
  filter(name == "å…¨å›½") |> 
  
  activate(time) |> rekey("æœˆæ¬¡") |> select(name) |>
  filter(str_detect(name, "2023å¹´[1-3]æœˆ")) |> 
  
  collect(n = "é‡‘é¡")
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 5. ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢

åˆ—åãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šä¸è¦ãªåˆ—ãŒæ¶ˆãˆãŸğŸ‘

```{r}
#| echo: true

head(chocolate)
```

## ã¾ã¨ã‚ğŸ“‹

-   jpstatğŸ“¦ã§e-Statãƒ‡ãƒ¼ã‚¿ã®åé›†ã‚’ç°¡å˜ã«
-   ä»–ã®çµ±è¨ˆAPIã«ã‚‚å¯¾å¿œã™ã‚‹ã‹ã‚‚
    -   å®Ÿé¨“çš„ã«RESAS APIãªã©ã«ã‚‚å¯¾å¿œ
-   Issueã‚„Pull Requestã¯[UchidaMizuki/jpstat](https://github.com/UchidaMizuki/jpstat)ã¾ã§

## EnjoyğŸ«

ä½™è«‡ï¼š2æœˆã¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆæ¶ˆè²»ãŒå¢—ãˆã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸâ—

```{r}
#| echo: true
#| code-fold: true

chocolate |> 
  mutate(ä¸–å¸¯åŒºåˆ†_name = ä¸–å¸¯åŒºåˆ†_name |> 
           str_remove("ï¼ˆ2000å¹´ï½ï¼‰$") |> 
           as_factor(),
         é‡‘é¡ = parse_number(é‡‘é¡)) |> 
  ggplot(aes(æœˆæ¬¡_name, é‡‘é¡,
             fill = ä¸–å¸¯åŒºåˆ†_name)) +
  geom_col(position = "dodge") +
  scale_x_discrete(NULL) +
  scale_y_continuous("1ä¸–å¸¯ã‚ãŸã‚Šé‡‘é¡ï¼»å††ï¼½",
                     labels = scales::label_comma()) +
  scale_fill_brewer("ä¸–å¸¯åŒºåˆ†",
                    palette = "Paired") +
  facet_wrap(~ å“ç›®åˆ†é¡_name)
```
