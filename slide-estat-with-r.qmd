---
title: "e-StatğŸ¤R"
subtitle: "Tokyo.R #108"
author: UchidaMizuki
date: "2023-09-02"
footer: <https://github.com/UchidaMizuki/jpstat>
format: 
  revealjs
---

## [e-Stat](https://www.e-stat.go.jp)ã¨ã¯â“

-   æ—¥æœ¬ã®æ”¿åºœçµ±è¨ˆãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ
-   å¤šãã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ãƒ»é–²è¦§ãƒ»å–å¾—å¯èƒ½ğŸ‘

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_001_1.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œç´¢ğŸ”

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_003.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠğŸ‘†

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_039.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 3. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’é¸æŠâœ…

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/e-stat_040.png){fig-align="center"}

## e-Statã®ä½¿ã„æ–¹ğŸ“Œ

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ğŸ’¾

![ç”»åƒå‡ºå…¸ï¼še-Stat](https://www.e-stat.go.jp/sites/default/files/inline-images/dbview01_1.png){fig-align="center"}

## e-StatğŸ¤R {auto-animate="true"}

### Rã§ã‚‚e-Statã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãŸã„â—

::: {.fragment .fade-in}
::: {style="text-align: center;"}
â¬
:::

### [e-Stat API](https://www.e-stat.go.jp/api/)

Rã§ã‚‚e-Statã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã‚‹â©[estatapi](https://yutannihilation.github.io/estatapi/)ğŸ“¦ã‚‚

1.  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œç´¢ğŸ”
2.  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠğŸ‘†
3.  ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’é¸æŠâœ…
4.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ğŸ’¾
:::

## e-StatğŸ¤R {auto-animate="true"}

### [e-Stat API](https://www.e-stat.go.jp/api/)

ãŸã ã—Webç‰ˆã¨æ¯”ã¹ã¦Step 3ï½ãŒç…©é›‘ã«ãªã‚ŠãŒã¡ğŸ˜–

3.  ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’é¸æŠâœ…
4.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ğŸ’¾

::: {.fragment .fade-in}
::: {style="text-align: center;"}
â¬
:::

### [jpstat](https://uchidamizuki.github.io/jpstat/)ğŸ“¦

-   åŠ¹ç‡çš„ãªçµ±è¨ˆãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ»å–å¾—ãƒ»æ•´å½¢ã«ç‰¹åŒ–ğŸ‘
-   dplyrğŸ“¦ã¨ãƒ‘ã‚¤ãƒ—ï¼ˆ`|>, %>%`ï¼‰ã‚’åˆ©ç”¨å¯èƒ½ğŸ‘
:::

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’è¨­å®š

-   e-Stat APIã®åˆ©ç”¨ã«ã¯[ãƒ¦ãƒ¼ã‚¶ç™»éŒ²](https://www.e-stat.go.jp/mypage/user/preregister)ãŒå¿…è¦
-   [åˆ©ç”¨ã‚¬ã‚¤ãƒ‰](https://www.e-stat.go.jp/api/api-info/api-guide)ã«å¾“ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’å–å¾—

```{r}
library(tidyverse)
library(jpstat)
```

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "8-9"

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¿…è¦ãªã‚‰ï¼‰ãƒ»èª­ã¿è¾¼ã¿
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("jpstat")) install.packages("jpstat")

library(tidyverse)
library(jpstat)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’è¿½åŠ 
Sys.setenv(ESTAT_API_KEY = "ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID")
```

::: aside
äº‹å‰ã«[åˆ©ç”¨è¦ç´„](https://www.e-stat.go.jp/api/api-info/api-guide)ã‚’ã”ç¢ºèªãã ã•ã„
:::

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 2. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’å–å¾—[^3]

[^3]: æ­£å¼ã«ã¯ãƒ¡ã‚¿æƒ…å ±ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ï¼

[å®¶è¨ˆèª¿æŸ»](https://www.e-stat.go.jp/dbview?sid=0003343671)ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å¯¾è±¡[^4]

[^4]: [estatapi](https://yutannihilation.github.io/estatapi/)ğŸ“¦ã®READMEã‚’å‚è€ƒã«ã—ã¾ã—ãŸï¼ãŸã ã—ï¼Œã“ã“ã§ã¯2023å¹´ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼

```{r}
#| echo: true

estat(statsDataId = "0003343671") # statsDataId: URLç­‰ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹çµ±è¨ˆè¡¨ID
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 3. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’æŠ½å‡º

`activate(), filter()`ã§ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆé–¢é€£å“ç›®ã‚’æŠ½å‡º

```{r}
#| echo: true
#| code-line-numbers: "2-3"

estat(statsDataId = "0003343671") |> 
  activate(cat01) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ"))
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 3. ãƒ‡ãƒ¼ã‚¿é …ç›®ã‚’æŠ½å‡º

ä»–ã®æŠ½å‡ºå‡¦ç†ã‚’ãƒ‘ã‚¤ãƒ—ï¼ˆ`|>, %>%`ï¼‰ã§ã¤ãªã’ã‚‰ã‚Œã‚‹

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "5-9"

estat(statsDataId = "0003343671") |> 
  activate(cat01) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ")) |> 
  
  activate(area) |> 
  filter(name == "å…¨å›½") |> 
  
  activate(time) |> 
  filter(str_detect(name, "2023å¹´[1-3]æœˆ"))
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

`collect()`ã§çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

```{r}
#| echo: true
#| code-line-numbers: "1,11"

chocolate <- estat(statsDataId = "0003343671") |> 
  activate(cat01) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ")) |> 
  
  activate(area) |> 
  filter(name == "å…¨å›½") |> 
  
  activate(time) |> 
  filter(str_detect(name, "2023å¹´[1-3]æœˆ")) |> 
  
  collect(n = "é‡‘é¡") # `n`ã§åé›†ãƒ‡ãƒ¼ã‚¿ã®åˆ—åã‚’æŒ‡å®š
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

åˆ—åãŒé›£è§£ã§åˆ—æ•°ãŒå¤šã„ğŸ˜–â©ãƒ‡ãƒ¼ã‚¿æ•´å½¢ã—ãŸã„â—

```{r}
#| echo: true

head(chocolate)
```



## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 5. ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢

`rekey(), select()`ã§åé›†ãƒ‡ãƒ¼ã‚¿ã®åˆ—åã‚’æŒ‡å®šã§ãã‚‹

```{r}
#| echo: true
#| code-line-numbers: "2,4,7,9,12"

chocolate <- estat(statsDataId = "0003343671") |> 
  activate(tab) |> select() |> # ä½•ã‚‚`select()`ã—ãªã„å ´åˆã¯åˆ—ãŒæ¶ˆãˆã‚‹
    
  activate(cat01) |> rekey("å“ç›®åˆ†é¡") |> select(name) |> 
  filter(str_detect(name, "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ")) |> 
  
  activate(cat02) |> rekey("ä¸–å¸¯åŒºåˆ†") |> select(name) |>
  
  activate(area) |> rekey("åœ°åŸŸåŒºåˆ†") |> select(name) |>
  filter(name == "å…¨å›½") |> 
  
  activate(time) |> rekey("æœˆæ¬¡") |> select(name) |>
  filter(str_detect(name, "2023å¹´[1-3]æœˆ")) |> 
  
  collect(n = "é‡‘é¡")
```

## jpstatğŸ“¦ã®ä½¿ã„æ–¹ğŸ“Œ {auto-animate="true"}

### 5. ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢

åˆ—åãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šä¸è¦ãªåˆ—ãŒæ¶ˆãˆãŸğŸ‘

```{r}
#| echo: true

head(chocolate)
```

## ã¾ã¨ã‚ğŸ“‹

-   [jpstat](https://github.com/UchidaMizuki/jpstat)ğŸ“¦ã§çµ±è¨ˆãƒ‡ãƒ¼ã‚¿åé›†ãŒæ¥½ã—ãç°¡å˜ã«

::: {.fragment .fade-in}
-   e-Statä»¥å¤–ã®çµ±è¨ˆAPIã«ã‚‚å¯¾å¿œã™ã‚‹ã‹ã‚‚
    -   ç¾åœ¨ï¼Œå®Ÿé¨“çš„ã«RESAS APIãªã©ã«å¯¾å¿œ
-   è¦æœ›ã‚„ãƒã‚°å ±å‘Šã¯[UchidaMizuki/jpstat/issues](https://github.com/UchidaMizuki/jpstat/issues)ã¾ã§

:::

## EnjoyğŸ«

ä½™è«‡ï¼š2æœˆã¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆæ¶ˆè²»ãŒå¢—ãˆã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸï¼

```{r}
#| echo: true
#| code-fold: true

chocolate |> 
  mutate(ä¸–å¸¯åŒºåˆ†_name = ä¸–å¸¯åŒºåˆ†_name |> 
           str_remove("ï¼ˆ2000å¹´ï½ï¼‰$") |> 
           as_factor(),
         é‡‘é¡ = parse_number(é‡‘é¡)) |> 
  ggplot(aes(æœˆæ¬¡_name, é‡‘é¡,
             fill = ä¸–å¸¯åŒºåˆ†_name)) +
  geom_col(position = "dodge") +
  scale_x_discrete(NULL) +
  scale_y_continuous("1ä¸–å¸¯ã‚ãŸã‚Šé‡‘é¡ï¼»å††ï¼½",
                     labels = scales::label_comma()) +
  scale_fill_brewer("ä¸–å¸¯åŒºåˆ†",
                    palette = "Paired") +
  facet_wrap(~ å“ç›®åˆ†é¡_name)
```
